@* Pages/Shared/_ChatWidget.cshtml *@
<div id="chat-widget" class="chat-widget" aria-live="polite">
    <div id="chat-status" class="chat-status">Support: checkingâ€¦</div>

    <button id="chat-toggle" class="chat-toggle" aria-expanded="false"
            aria-controls="chat-panel" title="Chat met ons">
        ğŸ’¬ Chat <span id="chat-unread" class="badge" hidden>0</span>
    </button>

    <section id="chat-panel" class="chat-panel" role="dialog"
             aria-label="Live Chat" aria-modal="false" hidden>
        <header class="chat-header">
            <div class="chat-title">Pepper Lier â€” Support</div>
            <button id="chat-close" class="chat-close" type="button" aria-label="Close">Ã—</button>
        </header>

        <div id="chat-messages" class="chat-messages" aria-live="polite" aria-relevant="additions"></div>

        <form id="chat-form" class="chat-form" autocomplete="off">
            <input id="chat-input" class="chat-input" type="text"
                   placeholder="Typ je berichtâ€¦" aria-label="Type a message" required />
            <button class="chat-send" type="submit" aria-label="Send">Send</button>
        </form>
    </section>
</div>

<style>
    /* Put the whole widget on top-right of the page */
    #chat-widget {
        position: fixed;
        right: 16px;
        bottom: 16px;
        z-index: 9999;
    }

    /* Really hide when [hidden] */
    #chat-panel[hidden] {
        display: none !important;
    }

    /* Panel: header | messages (flex) | form (pinned) */
    #chat-panel {
        width: min(92vw, 420px);
        height: clamp(420px, 70vh, 640px);
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0,0,0,.18);
        padding: 12px;
    }

    .chat-header {
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    /* IMPORTANT: only messages scroll; kill any global fixed height */
    #chat-widget .chat-messages {
        flex: 1 1 auto !important;
        min-height: 0 !important; /* lets flex child shrink */
        height: auto !important; /* override any global height */
        overflow-y: auto !important;
        background: #f8f6f0;
        border-radius: 8px;
        padding: 10px;
    }

    /* Input stays pinned at bottom, even if more bubbles arrive */
    #chat-widget .chat-form {
        flex: 0 0 auto;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        align-items: center;
        position: sticky; /* extra safety */
        bottom: 0;
        background: #fff;
    }



    /* panel sÃ¼tun dÃ¼zeni: baÅŸlÄ±k | mesajlar | form */
    #chat-panel {
        display: flex;
        flex-direction: column;
    }

    /* mesaj alanÄ± esnesin ve scroll olsun */
    #chat-widget .chat-messages {
        flex: 1 1 auto !important;
        min-height: 0 !important;
        overflow-y: auto !important;
    }

    /* form sabit yÃ¼kseklik, altta kalsÄ±n */
    #chat-widget .chat-form {
        flex: 0 0 auto;
    }



    /* Panel, sabit bir yÃ¼kseklikte kolon dÃ¼zeninde olmalÄ± */
    #chat-panel {
        /* paneli sabitleyen veya konumlandÄ±ran kendi kurallarÄ±nÄ±z varsa kalsÄ±n */
        display: flex !important;
        flex-direction: column !important;
        /* panel ekran dÄ±ÅŸÄ±na taÅŸmasÄ±n; yÃ¼ksekliÄŸi sabitle */
        height: 72vh; /* panel yÃ¼ksekliÄŸi */
        max-height: calc(100vh - 120px); /* emniyet payÄ± */
        width: min(440px, 94vw); /* mobilde taÅŸmamasÄ± iÃ§in */
    }

    /* Mesaj bÃ¶lmesi esneyip iÃ§inde scroll etsin */
    #chat-widget .chat-messages {
        flex: 1 1 auto !important;
        min-height: 0 !important; /* flex Ã§ocuklarÄ±nda gerekli */
        overflow-y: auto !important;
    }

    /* Form sabit yÃ¼kseklikte, altta kalsÄ±n */
    #chat-widget .chat-form {
        flex: 0 0 auto !important;
    }

</style>
